<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учет Долгов</title>
    <!-- Tailwind CSS для стилей -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Подключаем Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Глобальные переменные для доступа к Firebase
        window.app = null;
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.isAuthReady = false;

        // Инициализация Firebase
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Убедимся, что конфигурация Firebase существует
        if (Object.keys(firebaseConfig).length > 0) {
            window.app = initializeApp(firebaseConfig);
            window.auth = getAuth(window.app);
            window.db = getFirestore(window.app);

            // Обработка аутентификации пользователя
            onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    window.userId = user.uid;
                } else {
                    // Если токен не предоставлен, входим анонимно
                    await signInAnonymously(window.auth);
                }
                window.isAuthReady = true;
                console.log("Аутентификация завершена. userId:", window.userId);
                setupFirestoreListeners();
            });

            // Запускаем аутентификацию
            if (initialAuthToken) {
                signInWithCustomToken(window.auth, initialAuthToken)
                    .catch(error => {
                        console.error("Ошибка при входе с токеном:", error);
                        signInAnonymously(window.auth);
                    });
            } else {
                signInAnonymously(window.auth);
            }
        } else {
            console.error("Firebase config не найден. Проверьте правильность конфигурации.");
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 24px;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            transition: border-color 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
            transform: translateY(-1px);
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        .notification-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }
        .notification-container.show {
            opacity: 1;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            color: #4b5563;
        }
        .tab-btn.active {
            background-color: white;
            color: #2563eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container pb-20">
        <!-- Заголовок приложения -->
        <h1 class="text-3xl font-bold text-center my-8 text-blue-800">Финансовый помощник</h1>

        <!-- Индикатор загрузки -->
        <div id="loading-indicator" class="flex justify-center items-center h-48">
            <p class="text-gray-500 text-lg">Загрузка...</p>
        </div>

        <!-- Контейнер для основного контента -->
        <div id="content-container" class="hidden">
            <!-- Блок с вкладками -->
            <div class="flex justify-center bg-gray-200 p-2 rounded-xl mb-4">
                <button id="main-tab" class="tab-btn active">Главная</button>
                <button id="income-tab" class="tab-btn">Доходы</button>
                <button id="debts-tab" class="tab-btn">Долги</button>
            </div>

            <!-- Главная вкладка -->
            <div id="main-content">
                <!-- Карточка с балансом -->
                <div class="card bg-blue-600 text-white flex flex-col items-center">
                    <h2 class="text-xl font-bold">Остаток до следующей зарплаты</h2>
                    <p class="text-4xl font-extrabold mt-2" id="remaining-balance">0 ₽</p>
                    <div class="flex justify-between w-full mt-4 text-sm font-semibold">
                        <span>Прогнозируемая ЗП: <span id="projected-income">0 ₽</span></span>
                        <span>Расходы: <span id="total-expenses">0 ₽</span></span>
                    </div>
                </div>

                <!-- Карточка с предстоящими платежами -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Предстоящие платежи</h2>
                    <div id="upcoming-payments" class="space-y-4">
                        <p class="text-gray-500 text-center">Нет предстоящих платежей.</p>
                    </div>
                </div>
            </div>

            <!-- Вкладка Доходы -->
            <div id="income-content" class="hidden">
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Добавить доход</h2>
                    <form id="income-form" class="space-y-4">
                        <input type="hidden" id="income-id">
                        <input type="text" id="income-title" class="form-input" placeholder="Название (например, Зарплата)" required>
                        <textarea id="income-description" class="form-input" placeholder="Описание (необязательно)"></textarea>
                        <input type="number" id="income-amount" class="form-input" placeholder="Сумма" required min="0">
                        <select id="income-frequency" class="form-input" required>
                            <option value="">Выберите частоту</option>
                            <option value="bi-weekly">Раз в 2 недели</option>
                            <option value="monthly">Ежемесячно</option>
                            <option value="once">Однократно</option>
                        </select>
                        <input type="date" id="income-date" class="form-input" required>
                        <button type="submit" class="btn btn-primary w-full" id="save-income-btn">Сохранить</button>
                    </form>
                </div>
                <div class="card mt-4">
                    <h2 class="text-xl font-bold mb-4">Мои доходы</h2>
                    <div id="income-list" class="space-y-4">
                        <p class="text-gray-500 text-center">Список доходов пуст.</p>
                    </div>
                </div>
            </div>

            <!-- Вкладка Долги -->
            <div id="debts-content" class="hidden">
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Добавить долг</h2>
                    <form id="debt-form" class="space-y-4">
                        <input type="hidden" id="debt-id">
                        <input type="text" id="debt-title" class="form-input" placeholder="Название (например, Ипотека)" required>
                        <textarea id="debt-description" class="form-input" placeholder="Описание (необязательно)"></textarea>
                        <input type="number" id="debt-amount" class="form-input" placeholder="Сумма" required min="0">
                        <select id="debt-category" class="form-input" required>
                            <option value="">Выберите категорию</option>
                            <option value="mortgage">Ипотека</option>
                            <option value="loan">Кредит</option>
                            <option value="credit_card">Кредитная карта</option>
                            <option value="person">Людям</option>
                            <option value="utility">Счета/Коммуналка</option>
                            <option value="other">Другое</option>
                        </select>
                        <select id="debt-frequency" class="form-input" required>
                            <option value="">Выберите частоту</option>
                            <option value="bi-weekly">Раз в 2 недели</option>
                            <option value="monthly">Ежемесячно</option>
                            <option value="quarterly">Ежеквартально</option>
                            <option value="annually">Ежегодно</option>
                            <option value="once">Однократно</option>
                        </select>
                        <input type="date" id="debt-due-date" class="form-input" required>
                        <button type="submit" class="btn btn-primary w-full" id="save-debt-btn">Сохранить</button>
                    </form>
                </div>
                <div class="card mt-4">
                    <h2 class="text-xl font-bold mb-4">Мои долги</h2>
                    <div id="debt-list" class="space-y-4">
                        <p class="text-gray-500 text-center">Список долгов пуст.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для подтверждения -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content">
            <p class="text-lg font-bold mb-4">Вы уверены?</p>
            <p id="confirm-message" class="mb-6">Вы действительно хотите удалить эту запись?</p>
            <div class="flex justify-end space-x-4">
                <button id="confirm-cancel-btn" class="btn bg-gray-300 text-gray-800">Отмена</button>
                <button id="confirm-ok-btn" class="btn btn-danger">Удалить</button>
            </div>
        </div>
    </div>

    <!-- Общий контейнер для уведомлений -->
    <div id="notification-container" class="notification-container">
        <span id="notification-message"></span>
    </div>

    <script>
        // Код Service Worker для PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => {
                        console.log('Service Worker зарегистрирован:', reg.scope);
                    })
                    .catch(err => {
                        console.error('Ошибка при регистрации Service Worker:', err);
                    });
            });
        }

        // --- Глобальные переменные и DOM-элементы ---
        const mainContent = document.getElementById('main-content');
        const incomeContent = document.getElementById('income-content');
        const debtsContent = document.getElementById('debts-content');
        const mainTab = document.getElementById('main-tab');
        const incomeTab = document.getElementById('income-tab');
        const debtsTab = document.getElementById('debts-tab');
        const incomeForm = document.getElementById('income-form');
        const debtForm = document.getElementById('debt-form');
        const incomeList = document.getElementById('income-list');
        const debtList = document.getElementById('debt-list');
        const confirmModal = document.getElementById('confirm-modal');
        const confirmMessage = document.getElementById('confirm-message');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const confirmOkBtn = document.getElementById('confirm-ok-btn');
        const notificationContainer = document.getElementById('notification-container');
        const notificationMessage = document.getElementById('notification-message');
        const loadingIndicator = document.getElementById('loading-indicator');
        const contentContainer = document.getElementById('content-container');
        
        // --- Переменные для данных ---
        let allIncome = [];
        let allDebts = [];
        let upcomingPaymentsData = [];

        // --- Управление UI и вкладками ---
        function showTab(tabId) {
            mainContent.classList.add('hidden');
            incomeContent.classList.add('hidden');
            debtsContent.classList.add('hidden');

            mainTab.classList.remove('active');
            incomeTab.classList.remove('active');
            debtsTab.classList.remove('active');

            if (tabId === 'main-content') {
                mainContent.classList.remove('hidden');
                mainTab.classList.add('active');
                renderMainDashboard();
            } else if (tabId === 'income-content') {
                incomeContent.classList.remove('hidden');
                incomeTab.classList.add('active');
            } else if (tabId === 'debts-content') {
                debtsContent.classList.remove('hidden');
                debtsTab.classList.add('active');
            }
        }

        mainTab.addEventListener('click', () => showTab('main-content'));
        incomeTab.addEventListener('click', () => showTab('income-content'));
        debtsTab.addEventListener('click', () => showTab('debts-content'));

        // --- Модальное окно подтверждения ---
        function showConfirmModal(message, onConfirm) {
            confirmMessage.textContent = message;
            confirmModal.classList.remove('hidden');
            confirmOkBtn.onclick = () => {
                onConfirm();
                confirmModal.classList.add('hidden');
            };
            confirmCancelBtn.onclick = () => {
                confirmModal.classList.add('hidden');
            };
        }

        // --- Уведомления ---
        function showNotification(message, duration = 3000) {
            notificationMessage.textContent = message;
            notificationContainer.classList.add('show');
            setTimeout(() => {
                notificationContainer.classList.remove('show');
            }, duration);
        }

        // --- Логика PWA и Push-уведомлений ---
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('Разрешение на уведомления получено.');
                } else {
                    console.warn('Разрешение на уведомления отклонено.');
                }
            }
        }

        function createPushReminder(debt) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const now = new Date();
                const dueDate = new Date(debt.dueDate);
                const timeDiff = dueDate.getTime() - now.getTime();
                
                if (timeDiff > 0) {
                     setTimeout(() => {
                        new Notification('Напоминание об оплате', {
                            body: `${debt.title}: ${debt.amount.toLocaleString('ru-RU')} ₽. Срок: ${new Date(debt.dueDate).toLocaleDateString('ru-RU')}`,
                            icon: 'https://placehold.co/128x128/2563EB/ffffff?text=PWA'
                        });
                    }, Math.max(0, timeDiff - 3600000));
                }
            }
        }

        // --- Логика расчетов ---
        function calculateRemainingBalance(income, debts) {
            const today = new Date();
            const twoWeeksFromNow = new Date();
            twoWeeksFromNow.setDate(today.getDate() + 14);

            let totalIncome = 0;
            let totalExpenses = 0;
            upcomingPaymentsData = [];

            // Расчет доходов
            income.forEach(item => {
                const payDate = new Date(item.payDate);
                let currentItemIncome = 0;
                if (payDate >= today && payDate <= twoWeeksFromNow) {
                    if (item.frequency === 'bi-weekly') {
                        currentItemIncome = item.amount;
                    } else if (item.frequency === 'monthly') {
                        currentItemIncome = item.amount;
                    } else if (item.frequency === 'once') {
                        currentItemIncome = item.amount;
                    }
                    totalIncome += currentItemIncome;
                }
            });
            
            // Расчет обязательных расходов
            debts.forEach(item => {
                const dueDate = new Date(item.dueDate);
                if (dueDate >= today && dueDate <= twoWeeksFromNow) {
                    totalExpenses += item.amount;
                    upcomingPaymentsData.push({ title: item.title, amount: item.amount, dueDate: item.dueDate });
                }
            });

            const projectedIncome = allIncome.find(inc => inc.title.toLowerCase().includes('зарплата'))?.amount || 0;
            document.getElementById('projected-income').textContent = `${projectedIncome.toLocaleString('ru-RU')} ₽`;
            document.getElementById('total-expenses').textContent = `${totalExpenses.toLocaleString('ru-RU')} ₽`;
            
            const remaining = totalIncome - totalExpenses;
            document.getElementById('remaining-balance').textContent = `${remaining.toLocaleString('ru-RU')} ₽`;
            
            renderUpcomingPayments();
        }

        function renderUpcomingPayments() {
            const container = document.getElementById('upcoming-payments');
            container.innerHTML = '';
            if (upcomingPaymentsData.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center">Нет предстоящих платежей.</p>';
            } else {
                upcomingPaymentsData.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                upcomingPaymentsData.forEach(payment => {
                    const paymentEl = document.createElement('div');
                    paymentEl.className = 'flex justify-between items-center bg-gray-50 p-3 rounded-lg';
                    paymentEl.innerHTML = `
                        <div>
                            <p class="font-bold">${payment.title}</p>
                            <p class="text-sm text-gray-500">${new Date(payment.dueDate).toLocaleDateString('ru-RU')}</p>
                        </div>
                        <p class="font-bold text-red-600">${payment.amount.toLocaleString('ru-RU')} ₽</p>
                    `;
                    container.appendChild(paymentEl);
                });
            }
        }

        // --- Функции для работы с Firestore (доходы) ---
        async function saveIncome(data) {
            try {
                const incomeCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/income`);
                if (data.id) {
                    const docRef = doc(incomeCollection, data.id);
                    await updateDoc(docRef, data);
                    showNotification('Доход обновлен!');
                } else {
                    await addDoc(incomeCollection, { ...data, createdAt: serverTimestamp() });
                    showNotification('Доход добавлен!');
                }
                incomeForm.reset();
                document.getElementById('income-id').value = '';
            } catch (error) {
                console.error("Ошибка при сохранении дохода: ", error);
                showNotification('Ошибка при сохранении дохода.');
            }
        }

        async function deleteIncome(id) {
            try {
                const incomeCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/income`);
                await deleteDoc(doc(incomeCollection, id));
                showNotification('Доход удален!');
            } catch (error) {
                console.error("Ошибка при удалении дохода: ", error);
                showNotification('Ошибка при удалении дохода.');
            }
        }

        // --- Функции для работы с Firestore (долги) ---
        async function saveDebt(data) {
            try {
                const debtCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/debts`);
                if (data.id) {
                    const docRef = doc(debtCollection, data.id);
                    await updateDoc(docRef, data);
                    showNotification('Долг обновлен!');
                } else {
                    await addDoc(debtCollection, { ...data, createdAt: serverTimestamp() });
                    showNotification('Долг добавлен!');
                }
                debtForm.reset();
                document.getElementById('debt-id').value = '';
            } catch (error) {
                console.error("Ошибка при сохранении долга: ", error);
                showNotification('Ошибка при сохранении долга.');
            }
        }

        async function deleteDebt(id) {
            try {
                const debtCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/debts`);
                await deleteDoc(doc(debtCollection, id));
                showNotification('Долг удален!');
            } catch (error) {
                console.error("Ошибка при удалении долга: ", error);
                showNotification('Ошибка при удалении долга.');
            }
        }

        // --- Рендеринг списков ---
        function renderIncomeList() {
            incomeList.innerHTML = '';
            if (allIncome.length === 0) {
                incomeList.innerHTML = '<p class="text-gray-500 text-center">Список доходов пуст.</p>';
                return;
            }
            allIncome.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'bg-white p-4 rounded-lg shadow-sm flex justify-between items-center';
                itemEl.innerHTML = `
                    <div>
                        <p class="font-bold">${item.title}</p>
                        <p class="text-sm text-gray-500">${item.description || 'Без описания'}</p>
                        <p class="font-semibold text-green-600 mt-1">${item.amount.toLocaleString('ru-RU')} ₽</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="text-blue-500 hover:text-blue-700 font-bold" onclick="editIncome('${item.id}')">Изменить</button>
                        <button class="text-red-500 hover:text-red-700 font-bold" onclick="showConfirmModal('Вы уверены, что хотите удалить доход "${item.title}"?', () => deleteIncome('${item.id}'))">Удалить</button>
                    </div>
                `;
                incomeList.appendChild(itemEl);
            });
        }

        function renderDebtList() {
            debtList.innerHTML = '';
            if (allDebts.length === 0) {
                debtList.innerHTML = '<p class="text-gray-500 text-center">Список долгов пуст.</p>';
                return;
            }
            allDebts.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'bg-white p-4 rounded-lg shadow-sm flex justify-between items-center';
                itemEl.innerHTML = `
                    <div>
                        <p class="font-bold">${item.title}</p>
                        <p class="text-sm text-gray-500">${item.description || 'Без описания'}</p>
                        <p class="font-semibold text-red-600 mt-1">${item.amount.toLocaleString('ru-RU')} ₽</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="text-blue-500 hover:text-blue-700 font-bold" onclick="editDebt('${item.id}')">Изменить</button>
                        <button class="text-red-500 hover:text-red-700 font-bold" onclick="showConfirmModal('Вы уверены, что хотите удалить долг "${item.title}"?', () => deleteDebt('${item.id}'))">Удалить</button>
                    </div>
                `;
                debtList.appendChild(itemEl);
                // Создаем напоминание для каждого долга
                createPushReminder(item);
            });
        }

        // --- Заполнение форм для редактирования ---
        window.editIncome = function(id) {
            const item = allIncome.find(i => i.id === id);
            if (item) {
                document.getElementById('income-id').value = item.id;
                document.getElementById('income-title').value = item.title;
                document.getElementById('income-description').value = item.description || '';
                document.getElementById('income-amount').value = item.amount;
                document.getElementById('income-frequency').value = item.frequency;
                document.getElementById('income-date').value = item.payDate;
                showTab('income-content');
            }
        }

        window.editDebt = function(id) {
            const item = allDebts.find(d => d.id === id);
            if (item) {
                document.getElementById('debt-id').value = item.id;
                document.getElementById('debt-title').value = item.title;
                document.getElementById('debt-description').value = item.description || '';
                document.getElementById('debt-amount').value = item.amount;
                document.getElementById('debt-category').value = item.category;
                document.getElementById('debt-frequency').value = item.frequency;
                document.getElementById('debt-due-date').value = item.dueDate;
                showTab('debts-content');
            }
        }

        // --- Слушатели событий форм ---
        incomeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const incomeData = {
                id: document.getElementById('income-id').value || null,
                title: document.getElementById('income-title').value,
                description: document.getElementById('income-description').value,
                amount: parseFloat(document.getElementById('income-amount').value),
                frequency: document.getElementById('income-frequency').value,
                payDate: document.getElementById('income-date').value,
            };
            saveIncome(incomeData);
        });

        debtForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const debtData = {
                id: document.getElementById('debt-id').value || null,
                title: document.getElementById('debt-title').value,
                description: document.getElementById('debt-description').value,
                amount: parseFloat(document.getElementById('debt-amount').value),
                category: document.getElementById('debt-category').value,
                frequency: document.getElementById('debt-frequency').value,
                dueDate: document.getElementById('debt-due-date').value,
            };
            saveDebt(debtData);
        });

        // --- Слушатели Firestore для обновления данных в реальном времени ---
        function setupFirestoreListeners() {
            // Если все готово, скрываем индикатор загрузки и показываем контент
            loadingIndicator.classList.add('hidden');
            contentContainer.classList.remove('hidden');

            // Слушатель для доходов
            const incomeCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/income`);
            onSnapshot(incomeCollection, (snapshot) => {
                allIncome = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Доходы обновлены:", allIncome);
                renderIncomeList();
                calculateRemainingBalance(allIncome, allDebts);
            });

            // Слушатель для долгов
            const debtCollection = collection(window.db, `artifacts/${appId}/users/${window.userId}/debts`);
            onSnapshot(debtCollection, (snapshot) => {
                allDebts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Долги обновлены:", allDebts);
                renderDebtList();
                calculateRemainingBalance(allIncome, allDebts);
            });
        }
        
        // --- Инициализация приложения ---
        window.addEventListener('load', () => {
            requestNotificationPermission();
        });
        
    </script>
</body>
</html>
